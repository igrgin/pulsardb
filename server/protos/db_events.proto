syntax = "proto3";

package db_events;

option go_package = "github.com/igrgin/pulsardb/server/gen/db_events;db_events";

enum DBEventType {
  SET = 0;
  GET = 1;
  DELETE = 2;
  SHUTDOWN = 3;
}

message DBEventRequest {
  DBEventType type = 1;
  string key = 2;  // Used for SET, GET, DELETE
  oneof value {
    string string_value = 3;
    int64  int_value    = 4;
    double double_value = 5;
    bool   bool_value   = 6;
    bytes  bytes_value  = 7;
  } // Only used for SET
  bool only_if_absent = 8;  // Only used for SET
  bool only_if_present = 9;  // Only used for SET
}

message DBEventResponse {
  DBEventType type = 1;
  bool success = 2;
  oneof value {
    string string_value = 3;
    int64  int_value    = 4;
    double double_value = 5;
    bool   bool_value   = 6;
    bytes  bytes_value  = 7;
  } // Only populated for GET
  string error_message = 8;  // Only populated on error
}

service DBEventService {
  rpc EnqueueDBEvent(DBEventRequest) returns (DBEventResponse);
}