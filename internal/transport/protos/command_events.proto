syntax = "proto3";

package events;

option go_package = "github.com/you/pulsardb/internal/transport/gen/commandevents;commandeventspb";

enum CommandEventType {
  SET = 0;
  GET = 1;
  DELETE = 2;
}

message CommandEventValue {
  oneof value {
    string string_value = 1;
    int64  int_value = 2;
    double double_value = 3;
    bool   bool_value = 4;
    bytes  bytes_value = 5;
  }
}

message CommandEventRequest {
  uint64 event_id = 1;
  CommandEventType type = 2;
  string key = 3;
  CommandEventValue value = 4;
}

message CommandEventResponse {
  uint64 event_id = 1;
  bool success = 3;
  CommandEventValue value = 4;
  CommandError error = 5;
}

message CommandError {
  ErrorCode code = 1;
  string message = 2;
}

enum ErrorCode {
  UNKNOWN = 0;
  KEY_NOT_FOUND = 1;
  INVALID_REQUEST = 2;
  NOT_LEADER = 3;
  NO_QUORUM = 4;
  TIMEOUT = 5;
}

message BatchedCommands {
  repeated CommandEventRequest commands = 1;
}

service CommandEventClientService {
  rpc ProcessCommandEvent(CommandEventRequest) returns (CommandEventResponse);
}